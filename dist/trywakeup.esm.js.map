{"version":3,"file":"trywakeup.esm.js","sources":["../src/env.js","../src/utils.js","../src/clipboard.js","../src/wakeup.js","../src/index.js"],"sourcesContent":["// env.js\n\nconst UA = navigator.userAgent || ''\n\nexport const isWeChat = () => /micromessenger/i.test(UA)\nexport const isQQ = () => / QQ\\/|MQQBrowser/i.test(UA) || /qq\\//i.test(UA)\nexport const isQQBrowser = () => /qqbrowser/i.test(UA)\nexport const isQzone = () => /qzone\\/.*_qz_/i.test(UA)\nexport const isDingTalk = () => /DINGTALK\\/([\\d.]+)/i.test(UA)\nexport const isAlipay = () => /AlipayClient|alipayclient/i.test(UA)\nexport const isIos = () => /iphone|ipad|ipod/i.test(UA)\nexport const isAndroid = () => /android/i.test(UA)\nexport const isChrome = () => /Chrome|CriOS/i.test(UA) && !/Edge/i.test(UA)\nexport const isSafari = () => /Safari/i.test(UA) && !/Chrome|CriOS/i.test(UA)\nexport const userAgent = UA\n\n// export helper platform label like original\nexport function platformLabel() {\n  if (isIos()) return 'ios'\n  if (isAndroid()) return 'android'\n  return 'unknown'\n}\n","export function parseQuery(qs, decode = false) {\n  const search = qs === undefined ? (location.search || '').replace(/^\\?/, '') : qs.replace(/^\\?/, '')\n  const parts = search ? search.split('&') : []\n  const ret = {}\n  for (const p of parts) {\n    if (!p) continue\n    const [k, ...rest] = p.split('=')\n    const v = rest.join('=')\n    ret[k] = decode ? decodeURIComponent(v || '') : (v || '')\n  }\n  return ret\n}\n\nexport function buildQuery(obj) {\n  const arr = []\n  for (const k in obj) {\n    if (Object.prototype.hasOwnProperty.call(obj, k) && obj[k] !== undefined && obj[k] !== null) {\n      arr.push(`${encodeURIComponent(k)}=${encodeURIComponent(String(obj[k]))}`)\n    }\n  }\n  return arr.length ? ('?' + arr.join('&')) : ''\n}\n\nexport function postJSON(url, data = {}, timeout = 5000) {\n  return new Promise((resolve, reject) => {\n    const xhr = new XMLHttpRequest()\n    xhr.open('POST', url, true)\n    xhr.setRequestHeader('Content-Type', 'application/json')\n    xhr.timeout = timeout\n    xhr.onreadystatechange = function () {\n      if (xhr.readyState === 4) {\n        try {\n          const status = xhr.status\n          if (status >= 200 && status < 300) {\n            const json = JSON.parse(xhr.responseText || '{}')\n            resolve(json)\n          }\n          else {\n            reject({ status: xhr.status, response: xhr.responseText })\n          }\n        }\n        catch (err) {\n          reject(err)\n        }\n      }\n    }\n    xhr.ontimeout = function () {\n      reject(new Error('timeout'))\n    }\n    try {\n      xhr.send(JSON.stringify(data))\n    }\n    catch (e) { reject(e) }\n  })\n}\n\nexport async function copyToClipboard(text) {\n  if (navigator.clipboard && navigator.clipboard.writeText) {\n    return navigator.clipboard.writeText(text).catch(() => {\n      const el = document.createElement('textarea')\n      el.value = text\n      el.setAttribute('readonly', '')\n      el.style.position = 'absolute'\n      el.style.left = '-9999px'\n      document.body.appendChild(el)\n      el.select()\n      try {\n        document.execCommand('copy')\n      }\n      // eslint-disable-next-line no-unused-vars\n      catch (e) {\n        // ignore\n      }\n      document.body.removeChild(el)\n    })\n  }\n  else {\n    const el = document.createElement('textarea')\n    el.value = text\n    el.setAttribute('readonly', '')\n    el.style.position = 'absolute'\n    el.style.left = '-9999px'\n    document.body.appendChild(el)\n    el.select()\n    try {\n      document.execCommand('copy')\n    }\n    // eslint-disable-next-line no-unused-vars\n    catch (e) {\n      // ignore\n    }\n    document.body.removeChild(el)\n    return Promise.resolve()\n  }\n}\n\n// visibility helpers (detect page hidden events)\nexport const visibility = (() => {\n  let hidden, visibilityChange\n  if (typeof document.hidden !== 'undefined') {\n    hidden = 'hidden'\n    visibilityChange = 'visibilitychange'\n  }\n  else if (typeof document.msHidden !== 'undefined') {\n    hidden = 'msHidden'\n    visibilityChange = 'msvisibilitychange'\n  }\n  else if (typeof document.webkitHidden !== 'undefined') {\n    hidden = 'webkitHidden'\n    visibilityChange = 'webkitvisibilitychange'\n  }\n  else {\n    hidden = null\n    visibilityChange = null\n  }\n  return { hidden, visibilityChange }\n})()\n","// clipboard.js\n// 支持按友盟原先逻辑：当 init 返回 clipboardToken，根据 opts.useClipboard 决定是否拷贝\n\nimport { copyToClipboard } from './utils.js'\n\nexport async function handleClipboard(instanceOpts = {}, solution = {}) {\n  // instanceOpts: user options per ULink instance (may provide useClipboard boolean or function)\n  // solution: data returned from /deeplink/init, may contain clipboardToken\n  try {\n    if (!solution || !solution.clipboardToken) return null\n    let token = null\n    if (instanceOpts.useClipboard === true || typeof instanceOpts.useClipboard === 'undefined') {\n      token = solution.clipboardToken\n    }\n    else if (typeof instanceOpts.useClipboard === 'function') {\n      try {\n        token = instanceOpts.useClipboard(solution.clipboardToken)\n      }\n      // eslint-disable-next-line no-unused-vars\n      catch (e) {\n        token = null\n      }\n    }\n    if (token && typeof token === 'string' && token.length > 0) {\n      // copy it\n      await copyToClipboard(token)\n      return token\n    }\n  }\n  // eslint-disable-next-line no-unused-vars\n  catch (e) {\n    // swallow errors\n  }\n  return null\n}\n","import {\n  isWeChat, isQQ, isIos, isAndroid, isChrome, isAlipay, isDingTalk,\n} from './env.js'\nimport { visibility } from './utils.js'\n\nfunction openByLocation(url) {\n  window.location.href = url\n}\nfunction openByIframe(url) {\n  const iframe = document.createElement('iframe')\n  iframe.style.display = 'none'\n  iframe.src = url\n  document.body.appendChild(iframe)\n  setTimeout(() => {\n    try {\n      document.body.removeChild(iframe)\n    }\n    // eslint-disable-next-line no-unused-vars\n    catch (_e) {\n    // 忽略异常\n    }\n  }, 2000)\n}\nfunction buildIntentURL(solution, fallback) {\n  try {\n    if (!solution) return null\n    const wake = solution.wakeupUrl || ''\n    if (/^intent:/.test(wake)) return wake\n    const m = wake.match(/^([a-zA-Z0-9.+-]+):\\/\\/(.*)/)\n    const scheme = m ? m[1] : (solution.scheme ? solution.scheme.split('://')[0] : null)\n    const hostPath = m ? m[2] : (solution.hostPath || '')\n    const pkg = solution.package || ''\n    const fb = encodeURIComponent(fallback || solution.downloadUrl || '')\n    if (!scheme || !pkg) {\n      return null\n    }\n    return `intent://${hostPath}#Intent;scheme=${scheme};package=${pkg};S.browser_fallback_url=${fb};end`\n  }\n  // eslint-disable-next-line no-unused-vars\n  catch (e) {\n    return null\n  }\n}\n\nfunction showBrowserOpenTip(customHtml) {\n  if (document.getElementById('__um_open_in_browser_tip')) return\n  const div = document.createElement('div')\n  div.id = '__um_open_in_browser_tip'\n  div.style.cssText = 'position:fixed;left:0;top:0;background:rgba(0,0,0,0.8);width:100%;height:100%;z-index:19910324;'\n  const box = document.createElement('div')\n  box.innerHTML = customHtml || '<div style=\"text-align:right; margin-top:2%; margin-right:5%;\"><img style=\"width:90%; margin:0 auto;\" src=\"//gw.alicdn.com/imgextra/i4/O1CN01UErd1C1xDN2zSmD5r_!!6000000006409-2-tps-1216-226.png\"></div>'\n  div.appendChild(box)\n  document.body.appendChild(div)\n  const btn = document.getElementById('__um_open_in_browser_ok')\n  if (btn) btn.addEventListener('click', () => {\n    try {\n      document.body.removeChild(div)\n    }\n    // eslint-disable-next-line no-unused-vars\n    catch (e) {\n      // ignore\n    }\n  })\n}\n\n/**\n * @description 尝试唤醒app\n * @param {Object} solution\n * @param {Object} opts\n * @param {number} opts.timeout\n * @param {function} opts.proxyOpenDownload\n * @param {function} opts.beforeOpenDownload\n * @param {function} opts.afterOpenDownload\n * @param {function} opts.useOpenInBrowerTips\n * @returns {Promise<{success: boolean, reason: string}>}\n */\nexport function tryWakeup(solution = {}, opts = {}) {\n  const timeout = typeof opts.timeout === 'number' ? opts.timeout : 2000\n  const proxyOpenDownload = typeof opts.proxyOpenDownload === 'function' ? opts.proxyOpenDownload : null\n  const beforeOpenDownload = typeof opts.beforeOpenDownload === 'function' ? opts.beforeOpenDownload : null\n  const afterOpenDownload = typeof opts.afterOpenDownload === 'function' ? opts.afterOpenDownload : null\n  const useOpenInBrowerTips = opts.useOpenInBrowerTips\n\n  return new Promise((resolve) => {\n    let opened = false\n    const start = Date.now()\n\n    function onSuccessDetected() {\n      opened = true\n      cleanup()\n      resolve({ success: true, reason: 'visibility' })\n    }\n    const vEvent = visibility.visibilityChange\n    if (vEvent) document.addEventListener(vEvent, function onVis() {\n      if (document.hidden) {\n        onSuccessDetected()\n      }\n    }, { once: true })\n\n    window.addEventListener('blur', function onBlur() {\n      setTimeout(() => {\n        if (!opened && (document.hidden || Date.now() - start > 200)) {\n          opened = true\n          cleanup()\n          resolve({ success: true, reason: 'blur' })\n        }\n      }, 50)\n    }, { once: true })\n\n    let timer = setTimeout(() => {\n      if (!opened) {\n        cleanup()\n        if (beforeOpenDownload) try {\n          beforeOpenDownload()\n        }\n        // eslint-disable-next-line no-unused-vars\n        catch (e) {\n          // ignore\n        }\n\n        if (proxyOpenDownload) {\n          try {\n            proxyOpenDownload(() => {\n              if (isWeChat() || isQQ()) {\n                showBrowserOpenTip()\n              }\n              else if (solution.downloadUrl) {\n                openByLocation(solution.downloadUrl)\n              }\n            }, { solution, opts })\n          }\n          // eslint-disable-next-line no-unused-vars\n          catch (e) {\n            if (!isWeChat() && !isQQ() && solution.downloadUrl) {\n              openByLocation(solution.downloadUrl)\n            }\n          }\n        }\n        else {\n          if (isWeChat() || isQQ()) {\n            if (typeof useOpenInBrowerTips === 'function') {\n              try {\n                useOpenInBrowerTips()\n              }\n              // eslint-disable-next-line no-unused-vars\n              catch (e) {\n                showBrowserOpenTip()\n              }\n            }\n            else {\n              showBrowserOpenTip()\n            }\n          }\n          else if (solution.downloadUrl) {\n            openByLocation(solution.downloadUrl)\n          }\n        }\n\n        if (afterOpenDownload)\n          try {\n            afterOpenDownload()\n          }\n          // eslint-disable-next-line no-unused-vars\n          catch (e) {\n          // ignore\n          }\n        resolve({ success: false, reason: 'timeout' })\n      }\n    }, timeout)\n\n    function cleanup() {\n      try {\n        clearTimeout(timer)\n      }\n      // eslint-disable-next-line no-unused-vars\n      catch (e) {\n        // ignore\n      }\n      if (vEvent) {\n        try {\n          document.removeEventListener(vEvent, onSuccessDetected)\n        }\n        // eslint-disable-next-line no-unused-vars\n        catch (e) {\n          // ignore\n        }\n      }\n      try {\n        window.removeEventListener('blur', () => {})\n      }\n      // eslint-disable-next-line no-unused-vars\n      catch (e) {\n        // ignore\n      }\n    }\n\n    // ----------- 唤端逻辑 -----------\n    try {\n      const wakeUrl = solution.wakeupUrl || solution.wakeup_url || solution.wakeup || solution.scheme || ''\n      const download = solution.downloadUrl || solution.download_url || solution.download\n      const type = solution.type || ''\n      console.log('tryWakeup', wakeUrl, download, type)\n      // 微信或者QQ不走唤醒，直接提示用户使用浏览器打开\n      if (isWeChat() || isQQ()) {\n        if (proxyOpenDownload) {\n          proxyOpenDownload(() => {\n            if (typeof useOpenInBrowerTips === 'function') {\n              try {\n                useOpenInBrowerTips()\n              }\n              // eslint-disable-next-line no-unused-vars\n              catch (e) {\n                showBrowserOpenTip()\n              }\n            }\n            else {\n              showBrowserOpenTip()\n            }\n          }, { solution, opts })\n        }\n        else {\n          if (typeof useOpenInBrowerTips === 'function') {\n            try {\n              useOpenInBrowerTips()\n            }\n            // eslint-disable-next-line no-unused-vars\n            catch (e) {\n              showBrowserOpenTip()\n            }\n          }\n          else {\n            showBrowserOpenTip()\n          }\n        }\n        return\n      }\n\n      // iOS universal link\n      if (isIos() && wakeUrl && /^https?:\\/\\//.test(wakeUrl)) {\n        openByLocation(wakeUrl)\n      }\n      // Android Chrome intent\n      else if (isAndroid() && isChrome()) {\n        const intentUrl = buildIntentURL(solution, download)\n        if (intentUrl) openByLocation(intentUrl)\n        else if (wakeUrl) openByIframe(wakeUrl)\n      }\n      // Alipay/DingTalk\n      else if (isAlipay() && solution.alipayUrl) {\n        openByLocation(solution.alipayUrl)\n      }\n      else if (isDingTalk() && solution.dingtalkUrl) {\n        openByLocation(solution.dingtalkUrl)\n      }\n      // default scheme\n      else if (wakeUrl) {\n        if (/^[a-zA-Z][a-zA-Z0-9+.-]*:\\/\\//.test(wakeUrl)) {\n          if (/^https?:\\/\\//.test(wakeUrl)) openByLocation(wakeUrl)\n          else openByIframe(wakeUrl)\n        }\n        else {\n          openByLocation(wakeUrl)\n        }\n      }\n    }\n    // eslint-disable-next-line no-unused-vars\n    catch (e) {\n      // ignore runtime open errors\n    }\n  })\n}\n","import { platformLabel } from './env.js'\nimport { handleClipboard } from './clipboard.js'\nimport { tryWakeup } from './wakeup.js'\n\nexport class ULink {\n  constructor(opts = {}) {\n    this.opts = opts || {}\n    this.id = opts.id || ''\n    this.data = opts.data || {}\n    this.selector = opts.selector || null\n    this.timeout = typeof opts.timeout === 'number' ? opts.timeout : 2000\n    this.lazy = !!opts.lazy\n    this.iosDeepLinksData = opts.iosDeepLinksData || null\n    this.androidDeepLinksData = opts.androidDeepLinksData || null\n    this.useOpenInBrowerTips = opts.useOpenInBrowerTips\n    this.proxyOpenDownload = opts.proxyOpenDownload\n    this.beforeOpenDownload = opts.beforeOpenDownload\n    this.afterOpenDownload = opts.afterOpenDownload\n    this.solution = null\n    this._readyCallbacks = []\n    if (!this.lazy) {\n      this.start()\n    }\n    if (this.selector) this._bindSelector(this.selector)\n  }\n\n  start() {\n    console.log('CustomULink start', this.opts)\n    const platform = platformLabel()\n    const jsonData = platform === 'ios'\n      ? this.iosDeepLinksData\n      : this.androidDeepLinksData\n    return new Promise((resolve, reject) => {\n      if (jsonData) {\n        const currentLinkData = jsonData.find(item => item.linkId === this.id)\n        const solution = { ...currentLinkData }\n        // 拼接 opts.data 到 wakeupUrl\n        if (solution.wakeupUrl && this.data && Object.keys(this.data).length > 0) {\n          const url = new URL(solution.wakeupUrl)\n          Object.entries(this.data).forEach(([key, value]) => {\n            url.searchParams.set(key, value)\n          })\n          solution.wakeupUrl = url.toString()\n        }\n\n        this.solution = solution\n        console.log('found link data', this.solution)\n\n        handleClipboard(this.opts, this.solution).catch(() => {})\n\n        this._readyCallbacks.forEach((cb) => {\n          try {\n            cb(null, this.solution)\n          }\n          // eslint-disable-next-line no-unused-vars\n          catch (e) {\n            // ignore\n          }\n        })\n        this._readyCallbacks.length = 0\n        resolve(this.solution)\n      }\n      else {\n        this._readyCallbacks.forEach((cb) => {\n          try {\n            cb(new Error('init_failed'), null)\n          }\n          // eslint-disable-next-line no-unused-vars\n          catch (e) {\n            // ignore\n          }\n        })\n        this._readyCallbacks.length = 0\n        reject(new Error('empty_data'))\n      }\n    })\n  }\n\n  ready(fn) {\n    if (this.solution) {\n      fn(null, this.solution)\n    }\n    else {\n      this._readyCallbacks.push(fn)\n    }\n  }\n\n  async wakeup(opts = {}) {\n    const merged = Object.assign({}, {\n      timeout: this.timeout,\n      proxyOpenDownload: this.proxyOpenDownload,\n      beforeOpenDownload: this.beforeOpenDownload,\n      afterOpenDownload: this.afterOpenDownload,\n      useOpenInBrowerTips: this.useOpenInBrowerTips,\n    }, opts)\n\n    if (!this.solution) {\n      await this.start()\n      return await tryWakeup(this.solution, merged)\n    }\n    return tryWakeup(this.solution, merged)\n  }\n\n  _bindSelector(selector) {\n    const handler = (ev) => {\n      if (this.lazy && !this.solution) {\n        this.start().then(() => this.wakeup({ action: 'click', elementId: ev.target.id, className: ev.target.className }))\n      }\n      else {\n        this.wakeup({ action: 'click', elementId: ev.target.id, className: ev.target.className })\n      }\n    }\n    if (typeof selector === 'string') {\n      document.addEventListener('click', function (e) {\n        let el = e.target.closest(selector)\n        while (el && el !== document) {\n          try {\n            handler(e)\n            break\n          }\n          // eslint-disable-next-line no-unused-vars\n          catch (err) { /* ignore invalid selectors */ }\n          el = el.parentNode\n        }\n      }, false)\n    }\n    else if (selector && selector.addEventListener) {\n      selector.addEventListener('click', handler, false)\n    }\n  }\n}\n\nexport function startULink(instances = []) {\n  const objs = []\n  if (!Array.isArray(instances)) instances = [instances]\n  for (const cfg of instances) {\n    const inst = new ULink(cfg)\n    objs.push(inst)\n  }\n  return objs\n}\n\nexport default {\n  ULink,\n  startULink,\n}\n"],"names":["UA","navigator","userAgent","isWeChat","test","isQQ","isIos","isAndroid","visibility","hidden","visibilityChange","document","msHidden","webkitHidden","async","handleClipboard","instanceOpts","solution","clipboardToken","token","useClipboard","e","length","text","clipboard","writeText","catch","el","createElement","value","setAttribute","style","position","left","body","appendChild","select","execCommand","removeChild","Promise","resolve","copyToClipboard","openByLocation","url","window","location","href","openByIframe","iframe","display","src","setTimeout","_e","showBrowserOpenTip","customHtml","getElementById","div","id","cssText","box","innerHTML","btn","addEventListener","tryWakeup","opts","timeout","proxyOpenDownload","beforeOpenDownload","afterOpenDownload","useOpenInBrowerTips","opened","start","Date","now","onSuccessDetected","cleanup","success","reason","vEvent","once","timer","downloadUrl","clearTimeout","removeEventListener","wakeUrl","wakeupUrl","wakeup_url","wakeup","scheme","download","download_url","type","console","log","intentUrl","fallback","wake","m","match","split","hostPath","pkg","package","fb","encodeURIComponent","buildIntentURL","alipayUrl","dingtalkUrl","ULink","constructor","this","data","selector","lazy","iosDeepLinksData","androidDeepLinksData","_readyCallbacks","_bindSelector","jsonData","reject","find","item","linkId","Object","keys","URL","entries","forEach","key","searchParams","set","toString","cb","Error","ready","fn","push","merged","assign","handler","ev","then","action","elementId","target","className","closest","err","parentNode","startULink","instances","objs","Array","isArray","cfg","inst","index"],"mappings":"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"}